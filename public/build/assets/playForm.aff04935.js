const o=document.getElementById("play"),f=document.getElementById("bet_amount"),I=document.getElementById("bet_crash"),u=document.getElementById("busted"),w=document.querySelector(".take-out-graph");document.getElementById("count-down");const i=document.createElement("div"),d=document.createElement("h2"),c=document.createElement("h2");let h=document.getElementById("point"),g;localStorage.getItem("user_token");function L(){o.addEventListener("click",async()=>{if(!f.value)alert("Please add amount");else if(!I.value)alert("please add crash point");else{const e=Number(f.value),a=$("#gt").val(),t=Number(a);if(e>t)alert("no enough money");else{o.setAttribute("disabled",""),o.innerText="Bet Placed";let n=localStorage.getItem("user_id"),s=localStorage.getItem("username"),m=$("input[name=_token]").val();const b={user_id:n,username:s,bet_amount:f.value,bet_crash:I.value,token:m,busted_value:g};$.ajax({url:"/api/setbet",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:b,success:function(r){if(r.status==!0){var _=r.lastID;localStorage.setItem("user_bet_id4next_round",_),localStorage.setItem("user_bet_value",I.value),T(),O(),o.innerText="Bet Placed for next round",o.setAttribute("disabled","")}}})}}})}function E(){let e=6;const a=setInterval(()=>{e--,d.innerText="Next Round In",c.innerText=`${e}`,d.classList.add("busted-text"),c.classList.add("busted-text","busted-text-other"),u.append(i),u.classList.add("busted-wrap"),i.append(d),i.append(c),e===0&&(clearInterval(a),u.innerText="",u.classList.remove("busted-wrap"),c.classList.remove("busted-text-other"),w.style.display="block",y(0))},1e3)}function y(e){function a(){$.get("/api/settings?name=min_game",function(l,v){var p=l[0].value;localStorage.setItem("min_crash",p)})}function t(){$.get("/api/settings?name=max_game",function(l,v){var p=l[0].value;localStorage.setItem("max_crash",p)})}a(),t();const n=Number(localStorage.getItem("min_crash")),s=Number(localStorage.getItem("max_crash")),m=n,b=s;var r=e;let _=0;o.removeAttribute("disabled");let x=localStorage.getItem("user_bet_id4next_round");x==null?o.innerText="Play":(localStorage.setItem("user_bet_id",x),o.innerText="Cash Out @",localStorage.removeItem("user_bet_id4next_round")),g=B(m,b);const k=g;localStorage.setItem("busted_value",k),$.post("api/save_busted_value",{busted_value:g,user_id:localStorage.getItem("user_id")});let S=[];const C=setInterval(()=>{_+=1,h.innerText=`${r.toFixed(2)}x`,r+=.01;let l=Number(r.toFixed(2));localStorage.getItem("busted_value");var v=localStorage.getItem("user_bet_value");l==v?(N(),localStorage.removeItem("user_bet_value"),localStorage.removeItem("busted_value")):(localStorage.removeItem("user_bet_value"),localStorage.removeItem("busted_value")),_<=1&&(S[_-2]=l,window.revenueChart.updateSeries([{data:S}])),l>=g&&(D(),clearInterval(C),h.innerHTML="",w.style.display="none",u.append(i),d.innerText="Busted",T(),c.innerText=`@ ${r.toFixed(2)}x`,d.classList.add("busted-text"),c.classList.add("busted-text"),u.append(i),u.classList.add("busted-wrap"),i.append(d),i.append(c),setTimeout(E,3e3))},100)}document.addEventListener("DOMContentLoaded",()=>{let e=B(.1,1.85);y(e),L()});function B(e,a){return Number((Math.random()*(a-e+1)+e).toFixed(2))}function D(){var e=localStorage.getItem("user_bet_id"),a=localStorage.getItem("user_id");$.ajax({url:"/api/check_if_win",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:{user_bet_id:e,user_id:a},success:function(t){t.status==!0?(N(),t.lastID,localStorage.removeItem("user_bet_id")):(A(),t.lastID,localStorage.removeItem("user_bet_id"))}})}async function T(){let e=localStorage.getItem("user_id");var a="/api/transactions/user_balance/"+e;$.ajaxSetup({headers:{Authorization:"Bearer "+localStorage.getItem("user_token")}}),$.getJSON(a,{}).done(function(t){JSON.stringify(t);var n=t.balance;$("#gt").val(n);function s(m){return m.toString().replace(/(\d)(?=(\d{ 3 })+(?!\d))/g,"$1,")}$("#user_wallet_bal").text(s(n))}).done(function(){}).fail(function(t,n,s){$("#user_wallet_bal").text("0.00"),$("#gt").val(0)}).always(function(){})}async function N(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"Hurray!!! you won",padding:"2em",customClass:"sweet-alerts"})}async function A(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"You lose bet, try again",padding:"2em",customClass:"sweet-alerts"})}async function O(){let e=localStorage.getItem("user_id");var a="/api/previous_game/"+e;$.ajaxSetup({headers:{Authorization:"Bearer "+localStorage.getItem("user_token")}}),$.getJSON(a,{}).done(function(t){JSON.stringify(t);var n=t.bet_crash,s=t.bet_amount;$("#previous_bet_point").text(n),$("#previous_bet_amount").text(s)}).done(function(){}).fail(function(t,n,s){}).always(function(){})}
