const s=document.getElementById("play"),d=document.getElementById("cashOutBtn"),I=document.getElementById("bet_amount"),x=document.getElementById("bet_crash"),B=document.getElementById("cashout_amount"),A=document.getElementById("previous_bet_point"),T=document.getElementById("previous_bet_amount"),b=document.getElementById("round"),u=document.getElementById("busted"),k=document.querySelector(".take-out-graph");document.getElementById("count-down");const i=document.createElement("div"),m=document.createElement("h2"),c=document.createElement("h2");let h=document.getElementById("point"),_;localStorage.getItem("user_token");const v=document.getElementById("moving-image");function E(){$.get("/api/settings?name=min_game",function(e,a){var t=e[0].value;localStorage.setItem("min_crash",t)})}function C(){$.get("/api/settings?name=max_game",function(e,a){var t=e[0].value;localStorage.setItem("max_crash",t)})}function F(){$.get("/api/settings?name=next_round_count",function(e,a){var t=e[0].value;localStorage.setItem("next_round_count",t)})}F();let f=400,S=0;function O(){v.style.left="300px",v.style.top="0px",s.addEventListener("click",async()=>{if(!I.value)alert("Please add amount");else if(!x.value)alert("please add crash point");else{const e=Number(I.value),a=$("#gt").val(),t=Number(a);if(e+50>t)alert("no enough money");else{s.setAttribute("disabled",""),s.innerText="Bet Placed";let n=localStorage.getItem("user_id"),o=localStorage.getItem("username"),r=$("input[name=_token]").val();const l={user_id:n,username:o,bet_amount:I.value,bet_crash:x.value,token:r,busted_value:_};$.ajax({url:"/api/setbet",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:l,success:function(g){if(g.status==!0){var y=g.lastID;localStorage.setItem("user_bet_id4next_round",y),localStorage.setItem("user_bet_value",x.value),w(),z(),s.innerText="Wait for next round",s.setAttribute("disabled","")}}})}}})}function H(){let e=localStorage.getItem("next_round_count");const a=setInterval(()=>{e--,m.innerText="Next Round In",c.innerText=`${e}`,m.classList.add("busted-text"),c.classList.add("busted-text","busted-text-other"),u.append(i),u.classList.add("busted-wrap"),i.append(m),i.append(c),e===0&&(clearInterval(a),u.innerText="",u.classList.remove("busted-wrap"),c.classList.remove("busted-text-other"),k.style.display="block",E(),Number(localStorage.getItem("min_crash")),L())},1e3)}function L(e){E(),C();const a=Number(localStorage.getItem("min_crash")),t=Number(localStorage.getItem("max_crash")),n=a,o=t;var r=a;s.removeAttribute("disabled");let l=localStorage.getItem("user_bet_id4next_round");l==null?(s.innerText="Play",b.value=0):(localStorage.setItem("user_bet_id",l),s.style.display="none",d.style.display="block",b.value=1,localStorage.removeItem("user_bet_id4next_round")),_=M(n,o);const g=_;localStorage.setItem("busted_value",g),$.post("api/save_busted_value",{busted_value:_,user_id:localStorage.getItem("user_id")});const y=setInterval(()=>{h.innerText=`${r.toFixed(2)}x`,r+=.01;let p=Number(r.toFixed(2));S+=1.5,f-=1,v.style.left=`${S}px`,v.style.top=`${f}px`,B.innerHTML=p;var D=A.innerHTML;B.innerHTML=(p*T.innerHTML).toFixed(2),localStorage.getItem("busted_value"),b.value==1&&p==D&&(j(),d.style.display="none",localStorage.removeItem("user_bet_value"),localStorage.removeItem("busted_value")),p>=_&&(P(),clearInterval(y),h.innerHTML="",k.style.display="none",u.append(i),m.innerText="Busted",w(),c.innerText=`@ ${r.toFixed(2)}x`,m.classList.add("busted-text"),c.classList.add("busted-text"),u.append(i),u.classList.add("busted-wrap"),i.append(m),i.append(c),setTimeout(H,3e3))},100);f=400,S=0}document.addEventListener("DOMContentLoaded",()=>{L(),O()});function M(e,a){return Number((Math.random()*(a-e+1)+e).toFixed(2))}function P(){var e=localStorage.getItem("user_bet_id");if(e!=null){var a=localStorage.getItem("user_id");$.ajax({url:"/api/check_if_win",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:{user_bet_id:e,user_id:a},success:function(t){t.status==!0?(t.lastID,localStorage.removeItem("user_bet_id"),d.style.display="none",s.style.display="block"):(N(),t.lastID,localStorage.removeItem("user_bet_id"),d.style.display="none",s.style.display="block")}})}}async function w(){let e=localStorage.getItem("user_id");var a="/api/transactions/user_balance/"+e;$.ajaxSetup({headers:{Authorization:"Bearer "+localStorage.getItem("user_token")}}),$.getJSON(a,{}).done(function(t){JSON.stringify(t);var n=t.balance;$("#gt").val(n);function o(r){return r.toString().replace(/(\d)(?=(\d{ 3 })+(?!\d))/g,"$1,")}$("#user_wallet_bal").text(o(n))}).done(function(){}).fail(function(t,n,o){$("#user_wallet_bal").text("0.00"),$("#gt").val(0)}).always(function(){})}async function j(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"Hurray!!! you won",padding:"2em",customClass:"sweet-alerts"})}async function N(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"You lose bet, try again",padding:"2em",customClass:"sweet-alerts"})}async function z(){let e=localStorage.getItem("user_id");var a="/api/previous_game/"+e;$.ajaxSetup({headers:{Authorization:"Bearer "+localStorage.getItem("user_token")}}),$.getJSON(a,{}).done(function(t){JSON.stringify(t);var n=t.bet_crash,o=t.bet_amount;$("#previous_bet_point").text(n),$("#previous_bet_amount").text(o)}).done(function(){}).fail(function(t,n,o){}).always(function(){})}d.addEventListener("click",function(e){let a=h.innerText;a=a.replace(/x/g,""),a=Number.parseFloat(a);var n=(a*Number.parseFloat(T.innerHTML).toFixed(2)).toFixed(2),o=localStorage.getItem("user_bet_id");if(o!=null){var r=localStorage.getItem("user_id");$.ajax({url:"/api/cashout_win",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:{user_bet_id:o,user_id:r,user_bet_amount:n},success:function(l){l.status==!0?(w(),l.lastID,localStorage.removeItem("user_bet_id"),d.style.display="none",s.style.display="none"):(N(),l.lastID,b.value==0,localStorage.removeItem("user_bet_id"),d.style.display="none",s.style.display="block")}})}});
