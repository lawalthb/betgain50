const o=document.getElementById("play"),v=document.getElementById("bet_amount"),p=document.getElementById("bet_crash"),l=document.getElementById("busted"),S=document.querySelector(".take-out-graph");document.getElementById("count-down");const r=document.createElement("div"),d=document.createElement("h2"),u=document.createElement("h2");let I=document.getElementById("point"),m;localStorage.getItem("user_token");function B(){o.addEventListener("click",async()=>{if(!v.value)alert("Please add amount");else if(!p.value)alert("please add crash point");else{const e=Number(v.value),a=localStorage.getItem("user_wallet_bal"),t=Number(a);if(e>t)alert("no enough money");else{o.setAttribute("disabled",""),o.innerText="Bet Placed";let s=localStorage.getItem("user_id"),n=localStorage.getItem("username"),i=$("input[name=_token]").val();const _={user_id:s,username:n,bet_amount:v.value,bet_crash:p.value,token:i,busted_value:m};$.ajax({url:"/api/setbet",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:_,success:function(c){if(c.status==!0){var b=c.lastID;localStorage.setItem("user_bet_id4next_round",b),localStorage.setItem("user_bet_value",p.value),w(),o.innerText="Bet Placed for next round",o.setAttribute("disabled","")}}})}}})}function T(){let e=6;const a=setInterval(()=>{e--,d.innerText="Next Round In",u.innerText=`${e}`,d.classList.add("busted-text"),u.classList.add("busted-text","busted-text-other"),l.append(r),l.classList.add("busted-wrap"),r.append(d),r.append(u),e===0&&(clearInterval(a),l.innerText="",l.classList.remove("busted-wrap"),u.classList.remove("busted-text-other"),S.style.display="block",x(0))},1e3)}function x(e){var s=e;let n=0;o.removeAttribute("disabled");let i=localStorage.getItem("user_bet_id4next_round");i==null?o.innerText="Play":(localStorage.setItem("user_bet_id",i),o.innerText="Cash Out @",localStorage.removeItem("user_bet_id4next_round")),m=f(1,3);const _=m;localStorage.setItem("busted_value",_),$.post("api/save_busted_value",{busted_value:m,user_id:localStorage.getItem("user_id")});let c=[];const b=setInterval(()=>{n+=1,I.innerText=`${s.toFixed(2)}x`,s+=.01;let g=Number(s.toFixed(2));localStorage.getItem("busted_value");var h=localStorage.getItem("user_bet_value");g==h?(y(),localStorage.removeItem("user_bet_value"),localStorage.removeItem("busted_value")):(localStorage.removeItem("user_bet_value"),localStorage.removeItem("busted_value")),n<=1e3&&(c[n-2]=g,window.revenueChart.updateSeries([{data:c}])),g>=m&&(k(),clearInterval(b),I.innerHTML="",S.style.display="none",l.append(r),d.innerText="Busted",w(),u.innerText=`@ ${s.toFixed(2)}x`,d.classList.add("busted-text"),u.classList.add("busted-text"),l.append(r),l.classList.add("busted-wrap"),r.append(d),r.append(u),setTimeout(T,3e3))},100)}document.addEventListener("DOMContentLoaded",()=>{let e=f(.1,1.85);x(e),B()});function f(e,a){return Number((Math.random()*(a-e+1)+e).toFixed(2))}function k(){var e=localStorage.getItem("user_bet_id"),a=localStorage.getItem("user_id");$.ajax({url:"/api/check_if_win",type:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("user_token")},data:{user_bet_id:e,user_id:a},success:function(t){t.status==!0?(y(),t.lastID,localStorage.removeItem("user_bet_id")):(C(),t.lastID,localStorage.removeItem("user_bet_id"))}})}async function w(){let e=localStorage.getItem("user_id");var a="/api/transactions/user_balance/"+e;$.ajaxSetup({headers:{Authorization:"Bearer "+localStorage.getItem("user_token")}}),$.getJSON(a,{}).done(function(t){JSON.stringify(t);var s=t.balance;localStorage.setItem("user_wallet_bal",s);function n(i){return i.toString().replace(/(\d)(?=(\d{ 3 })+(?!\d))/g,"$1,")}$("#user_wallet_bal").text(n(s))}).done(function(){}).fail(function(t,s,n){$("#user_wallet_bal").text("0.00"),localStorage.setItem("user_wallet_bal",0)}).always(function(){})}async function y(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"Hurray!!! you won",padding:"2em",customClass:"sweet-alerts"})}async function C(){window.Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,padding:"2em",customClass:"sweet-alerts"}).fire({icon:"success",title:"You lose bet, try again",padding:"2em",customClass:"sweet-alerts"})}
